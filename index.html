<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blind Test Master - 15 Titres par Catégorie</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; margin: 0; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icons = {
          Play: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
          Music: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>,
          Trophy: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55.47.98.97 1.21C11.47 18.44 12 19 12 19s.53-.56 1.03-.79c.5-.23.97-.66.97-1.21v-2.34"></path><path d="M12 15a6 6 0 0 0 6-6V3H6v6a6 6 0 0 0 6 6Z"></path></svg>,
          ChevronLeft: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>,
          Users: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>,
          Check: () => <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" strokeWidth="3" fill="none" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>,
          Film: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="2" width="20" height="20" rx="2" ry="2"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>,
          Mic: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
        };

        const CATEGORIES = {
          Y2K: {
            id: "2000s",
            label: "Années 2000",
            icon: <Icons.Music />,
            color: "from-purple-600 to-blue-600",
            list: [
              { artist: "Britney Spears", title: "Toxic" },
              { artist: "Shakira", title: "Whenever Wherever" },
              { artist: "Eminem", title: "Without Me" },
              { artist: "Diam's", title: "La Boulette" },
              { artist: "Beyonce", title: "Crazy In Love" },
              { artist: "Evanescence", title: "Bring Me To Life" },
              { artist: "Black Eyed Peas", title: "I Gotta Feeling" },
              { artist: "K-Maro", title: "Femme Like U" },
              { artist: "Rihanna", title: "Umbrella" },
              { artist: "Lady Gaga", title: "Poker Face" },
              { artist: "Indochine", title: "J'ai demandé à la lune" },
              { artist: "Lorie", title: "Sur un air de guitare" },
              { artist: "Las Ketchup", title: "Asereje" },
              { artist: "O-Zone", title: "Dragostea Din Tei" },
              { artist: "Alizée", title: "Moi... Lolita" }
            ]
          },
          MODERN: {
            id: "2025fr",
            label: "Top 2025 France",
            icon: <Icons.Play />,
            color: "from-red-600 to-orange-500",
            list: [
              { artist: "Gazo", title: "POP" },
              { artist: "SDM", title: "Cartier Santos" },
              { artist: "Pierre Garnier", title: "Chaque seconde" },
              { artist: "Santa", title: "Recommence-moi" },
              { artist: "Aya Nakamura", title: "Hypé" },
              { artist: "Slimane", title: "Mon Amour" },
              { artist: "Clara Luciani", title: "Tout pour moi" },
              { artist: "Carbonne", title: "Imagine" },
              { artist: "Tiakola", title: "Manon B" },
              { artist: "Damso", title: "Chrome" },
              { artist: "Ninho", title: "Eurostar" },
              { artist: "Louane", title: "La pluie" },
              { artist: "Werenoi", title: "Pyramide" },
              { artist: "Jungeli", title: "Petit Génie" },
              { artist: "Zola", title: "Amber" }
            ]
          },
          RAP: {
            id: "rap",
            label: "Rap FR & US",
            icon: <Icons.Mic />,
            color: "from-emerald-600 to-teal-800",
            list: [
              { artist: "Eminem", title: "Lose Yourself" },
              { artist: "Dr. Dre", title: "Still D.R.E." },
              { artist: "IAM", title: "Demain c'est loin" },
              { artist: "Ninho", title: "Lettre à une femme" },
              { artist: "Snoop Dogg", title: "Drop It Like It's Hot" },
              { artist: "Booba", title: "DKR" },
              { artist: "Jay-Z", title: "Empire State of Mind" },
              { artist: "PNL", title: "Au DD" },
              { artist: "Macklemore", title: "Thrift Shop" },
              { artist: "Jul", title: "Tchikita" },
              { artist: "Coolio", title: "Gangsta's Paradise" },
              { artist: "50 Cent", title: "Candy Shop" },
              { artist: "Orelsan", title: "La Terre est ronde" },
              { artist: "Nekfeu", title: "On verra" },
              { artist: "113", title: "Tonton du Bled" }
            ]
          },
          FILMS: {
            id: "films",
            label: "Cinéma & Séries",
            icon: <Icons.Film />,
            color: "from-amber-500 to-red-700",
            list: [
              { artist: "John Williams", title: "Star Wars Main Theme" },
              { artist: "Hans Zimmer", title: "Pirates of the Caribbean" },
              { artist: "Celine Dion", title: "My Heart Will Go On" },
              { artist: "John Williams", title: "Hedwig's Theme" },
              { artist: "Hans Zimmer", title: "Time Inception" },
              { artist: "Lalo Schifrin", title: "Mission Impossible" },
              { artist: "Monty Norman", title: "James Bond Theme" },
              { artist: "Ramin Djawadi", title: "Game of Thrones" },
              { artist: "Elton John", title: "Circle of Life" },
              { artist: "Bill Conti", title: "Gonna Fly Now Rocky" },
              { artist: "Ray Parker Jr.", title: "Ghostbusters" },
              { artist: "Dick Dale", title: "Misirlou Pulp Fiction" },
              { artist: "Adele", title: "Skyfall" },
              { artist: "Survivor", title: "Eye of the Tiger" },
              { artist: "Pharrell Williams", title: "Happy" }
            ]
          }
        };

        const TIMER_DURATION = 15;

        function App() {
          const [gameState, setGameState] = useState('menu');
          const [category, setCategory] = useState(null);
          const [currentIdx, setCurrentIdx] = useState(0);
          const [team1, setTeam1] = useState({ name: "Équipe A", score: 0 });
          const [team2, setTeam2] = useState({ name: "Équipe B", score: 0 });
          const [timeLeft, setTimeLeft] = useState(TIMER_DURATION);
          const [guess, setGuess] = useState('');
          const [trackData, setTrackData] = useState(null);
          const [loading, setLoading] = useState(false);
          const [feedback, setFeedback] = useState({ show: false, artistFound: false, titleFound: false, pointsAwarded: { artist: 0, title: 0 } });
          const audioRef = useRef(null);
          const timerRef = useRef(null);

          const fetchTrack = async (index, cat) => {
            setLoading(true);
            setTrackData(null);
            const track = cat.list[index];
            try {
              const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(track.artist + " " + track.title)}&limit=1&entity=musicTrack`);
              const data = await response.json();
              if (data.results && data.results[0]) {
                const hdArt = data.results[0].artworkUrl100.replace('100x100bb', '600x600bb');
                setTrackData({ ...data.results[0], hdArt });
              } else {
                setTrackData({ artistName: track.artist, trackName: track.title, previewUrl: "", hdArt: "" });
              }
            } catch (e) { console.error(e); }
            setLoading(false);
          };

          const selectCategory = (catKey) => {
            const selectedCat = CATEGORIES[catKey];
            setCategory(selectedCat);
            setTeam1(prev => ({ ...prev, score: 0 }));
            setTeam2(prev => ({ ...prev, score: 0 }));
            setCurrentIdx(0);
            setGuess('');
            setGameState('playing');
            fetchTrack(0, selectedCat);
          };

          const checkAnswer = () => {
            if (loading || !trackData) return;
            const normalizedGuess = guess.toLowerCase().trim();
            const artistFound = normalizedGuess.length > 2 && trackData.artistName.toLowerCase().includes(normalizedGuess);
            const titleFound = normalizedGuess.length > 2 && trackData.trackName.toLowerCase().includes(normalizedGuess);
            setFeedback({ show: true, artistFound, titleFound, pointsAwarded: { artist: 0, title: 0 } });
            setGameState('feedback');
            clearInterval(timerRef.current);
            if (audioRef.current) audioRef.current.pause();
          };

          const togglePoint = (type, teamNum) => {
            setFeedback(prev => {
                const currentOwner = prev.pointsAwarded[type];
                const newOwner = currentOwner === teamNum ? 0 : teamNum;
                if (currentOwner === 1) setTeam1(t => ({ ...t, score: t.score - 1 }));
                if (currentOwner === 2) setTeam2(t => ({ ...t, score: t.score - 1 }));
                if (newOwner === 1) setTeam1(t => ({ ...t, score: t.score + 1 }));
                if (newOwner === 2) setTeam2(t => ({ ...t, score: t.score + 1 }));
                return { ...prev, pointsAwarded: { ...prev.pointsAwarded, [type]: newOwner } };
            });
          };

          const handleNext = () => {
            if (currentIdx + 1 < category.list.length) {
              const nextIdx = currentIdx + 1;
              setCurrentIdx(nextIdx);
              setGameState('playing');
              setGuess('');
              setTimeLeft(TIMER_DURATION);
              setFeedback({ show: false, artistFound: false, titleFound: false, pointsAwarded: { artist: 0, title: 0 } });
              fetchTrack(nextIdx, category);
            } else { setGameState('end'); }
          };

          useEffect(() => {
            if (gameState === 'playing' && !loading && trackData) {
              setTimeLeft(TIMER_DURATION);
              timerRef.current = setInterval(() => {
                setTimeLeft(p => {
                  if (p <= 1) {
                    clearInterval(timerRef.current);
                    setFeedback({ show: true, artistFound: false, titleFound: false, pointsAwarded: { artist: 0, title: 0 } });
                    setGameState('feedback');
                    return 0;
                  }
                  return p - 1;
                });
              }, 1000);
            }
            return () => clearInterval(timerRef.current);
          }, [gameState, loading, trackData]);

          useEffect(() => {
            if (trackData?.previewUrl && audioRef.current && gameState === 'playing') {
              audioRef.current.load();
              audioRef.current.play().catch(() => {});
            }
          }, [trackData, gameState]);

          return (
            <div className="min-h-screen bg-neutral-950 text-white flex flex-col items-center justify-center p-4 font-sans selection:bg-white/20">
              <div className="w-full max-w-md bg-neutral-900 rounded-[2.5rem] shadow-2xl overflow-hidden border border-neutral-800 relative min-h-[680px] flex flex-col">
                <div className={`p-8 text-center bg-gradient-to-r ${category ? category.color : 'from-neutral-800 to-neutral-900'} transition-all relative`}>
                  {gameState !== 'menu' && (
                    <button onClick={() => { setGameState('menu'); if(audioRef.current) audioRef.current.pause(); }} className="absolute top-8 left-6 p-2 bg-black/20 rounded-full hover:bg-black/40">
                      <Icons.ChevronLeft />
                    </button>
                  )}
                  <h1 className="text-2xl font-black italic uppercase tracking-tighter">Blind Test Master</h1>
                  <p className="text-[10px] font-bold uppercase tracking-widest opacity-70 mt-1">15 Titres par Catégorie</p>
                </div>

                <div className="p-8 flex-grow flex flex-col">
                  {gameState === 'menu' && (
                    <div className="space-y-6 animate-in fade-in duration-500 my-auto">
                      <div className="bg-neutral-800/50 p-6 rounded-3xl border border-white/5 space-y-4">
                        <div className="flex items-center gap-2 mb-2 opacity-50"><Icons.Users /><span className="text-xs font-black uppercase tracking-widest">Équipes</span></div>
                        <div className="grid grid-cols-2 gap-3">
                            <input value={team1.name} onChange={(e) => setTeam1({...team1, name: e.target.value})} className="bg-black/40 border border-white/10 rounded-xl px-4 py-2 text-sm outline-none focus:border-purple-500" placeholder="Équipe 1"/>
                            <input value={team2.name} onChange={(e) => setTeam2({...team2, name: e.target.value})} className="bg-black/40 border border-white/10 rounded-xl px-4 py-2 text-sm outline-none focus:border-orange-500" placeholder="Équipe 2"/>
                        </div>
                      </div>
                      <div className="space-y-3 max-h-[320px] overflow-y-auto custom-scroll pr-1">
                        {Object.entries(CATEGORIES).map(([key, cat]) => (
                            <button key={key} onClick={() => selectCategory(key)} className={`w-full bg-gradient-to-r ${cat.color} p-5 rounded-2xl flex items-center justify-between group hover:scale-[1.02] transition-all`}>
                                <div className="flex items-center gap-4 text-left">
                                    <div className="bg-white/10 p-2 rounded-lg">{cat.icon}</div>
                                    <div>
                                        <span className="block text-lg font-black italic">{cat.label}</span>
                                        <span className="text-[9px] font-bold opacity-70 uppercase">{cat.list.length} Morceaux</span>
                                    </div>
                                </div>
                                <Icons.Play />
                            </button>
                        ))}
                      </div>
                    </div>
                  )}

                  {gameState === 'playing' && (
                    <div className="flex-grow flex flex-col justify-between space-y-6">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-purple-600/20 border border-purple-500/30 p-3 rounded-2xl text-center"><p className="text-[9px] font-black uppercase tracking-widest text-purple-400 truncate">{team1.name}</p><p className="text-2xl font-black">{team1.score}</p></div>
                        <div className="bg-orange-600/20 border border-orange-500/30 p-3 rounded-2xl text-center"><p className="text-[9px] font-black uppercase tracking-widest text-orange-400 truncate">{team2.name}</p><p className="text-2xl font-black">{team2.score}</p></div>
                      </div>
                      <div className="text-center">
                        <div className="text-5xl font-black font-mono mb-2">{timeLeft}s</div>
                        <div className="h-1.5 w-full bg-neutral-800 rounded-full overflow-hidden"><div style={{ width: `${(timeLeft / TIMER_DURATION) * 100}%` }} className={`h-full transition-all duration-1000 linear ${timeLeft < 5 ? 'bg-red-500' : 'bg-white'}`} /></div>
                      </div>
                      {loading ? <div className="flex-grow flex flex-col items-center justify-center py-20"><div className="w-10 h-10 border-4 border-white/10 border-t-white rounded-full animate-spin"></div></div> : (
                        <div className="flex-grow flex flex-col justify-center space-y-8 animate-in zoom-in-95 duration-300">
                          <audio ref={audioRef} src={trackData?.previewUrl} preload="auto" />
                          <div className="aspect-square bg-neutral-800 rounded-[2rem] flex items-center justify-center border border-white/5 relative overflow-hidden"><div className="animate-pulse opacity-50 scale-150"><Icons.Music /></div></div>
                          <div className="space-y-4">
                            <input autoFocus value={guess} onChange={(e) => setGuess(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && checkAnswer()} placeholder="Tape ta réponse..." className="w-full bg-black border border-neutral-800 rounded-2xl p-5 text-center text-lg outline-none font-bold" />
                            <button onClick={checkAnswer} className="w-full bg-white text-black font-black py-5 rounded-2xl hover:bg-neutral-200 active:scale-95 transition-all shadow-xl shadow-white/5">VÉRIFIER</button>
                          </div>
                        </div>
                      )}
                    </div>
                  )}

                  {gameState === 'feedback' && (
                    <div className="flex-grow flex flex-col justify-center space-y-6 animate-in fade-in duration-500">
                      <div className="text-center">
                        <div className="w-32 h-32 mx-auto mb-4"><img src={trackData?.hdArt} className="w-full h-full object-cover rounded-2xl shadow-2xl" /></div>
                        <p className="text-xl font-black text-white leading-tight">{trackData?.artistName}</p>
                        <p className="text-neutral-500 font-medium text-xs italic mt-1">"{trackData?.trackName}"</p>
                      </div>
                      <div className="space-y-4">
                        <div className="bg-neutral-800/50 p-3 rounded-2xl border border-white/5">
                            <div className="text-[9px] font-bold text-neutral-400 mb-2 uppercase text-center tracking-widest">Artiste (1 pt)</div>
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => togglePoint('artist', 1)} className={`py-3 rounded-xl text-[10px] font-black flex items-center justify-center gap-2 transition-all ${feedback.pointsAwarded.artist === 1 ? 'bg-purple-600 text-white' : 'bg-black/40 text-neutral-500'}`}>{feedback.pointsAwarded.artist === 1 && <Icons.Check />} {team1.name}</button>
                                <button onClick={() => togglePoint('artist', 2)} className={`py-3 rounded-xl text-[10px] font-black flex items-center justify-center gap-2 transition-all ${feedback.pointsAwarded.artist === 2 ? 'bg-orange-600 text-white' : 'bg-black/40 text-neutral-500'}`}>{feedback.pointsAwarded.artist === 2 && <Icons.Check />} {team2.name}</button>
                            </div>
                        </div>
                        <div className="bg-neutral-800/50 p-3 rounded-2xl border border-white/5">
                            <div className="text-[9px] font-bold text-neutral-400 mb-2 uppercase text-center tracking-widest">Titre (1 pt)</div>
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => togglePoint('title', 1)} className={`py-3 rounded-xl text-[10px] font-black flex items-center justify-center gap-2 transition-all ${feedback.pointsAwarded.title === 1 ? 'bg-purple-600 text-white' : 'bg-black/40 text-neutral-500'}`}>{feedback.pointsAwarded.title === 1 && <Icons.Check />} {team1.name}</button>
                                <button onClick={() => togglePoint('title', 2)} className={`py-3 rounded-xl text-[10px] font-black flex items-center justify-center gap-2 transition-all ${feedback.pointsAwarded.title === 2 ? 'bg-orange-600 text-white' : 'bg-black/40 text-neutral-500'}`}>{feedback.pointsAwarded.title === 2 && <Icons.Check />} {team2.name}</button>
                            </div>
                        </div>
                        <button onClick={handleNext} className="w-full bg-white text-black font-black py-4 rounded-2xl shadow-xl hover:bg-neutral-200">CONTINUER</button>
                      </div>
                    </div>
                  )}

                  {gameState === 'end' && (
                    <div className="flex-grow flex flex-col items-center justify-center text-center space-y-8 py-6">
                      <div className="text-yellow-500 scale-[2.5] mb-6 drop-shadow-[0_0_15px_rgba(234,179,8,0.5)]"><Icons.Trophy /></div>
                      <div className="space-y-4 w-full">
                        <h2 className="text-3xl font-black italic uppercase italic">Résultats Finaux</h2>
                        <div className={`p-6 rounded-3xl flex justify-between items-center ${team1.score >= team2.score ? 'bg-purple-600' : 'bg-neutral-800'}`}><span className="font-black italic text-lg">{team1.name}</span><span className="text-4xl font-black tabular-nums">{team1.score}</span></div>
                        <div className={`p-6 rounded-3xl flex justify-between items-center ${team2.score >= team1.score ? 'bg-orange-600' : 'bg-neutral-800'}`}><span className="font-black italic text-lg">{team2.name}</span><span className="text-4xl font-black tabular-nums">{team2.score}</span></div>
                      </div>
                      <button onClick={() => setGameState('menu')} className="w-full bg-white text-black font-black py-5 rounded-2xl shadow-xl hover:bg-neutral-200">REJOUER</button>
                    </div>
                  )}
                </div>
              </div>
              <div className="mt-8 text-neutral-600 text-[9px] font-black uppercase tracking-[0.3em]">Blind Test Master • 60 Titres Cultes</div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
