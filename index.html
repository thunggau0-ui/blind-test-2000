<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blind Test Master - 2000s & 2025</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; margin: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // On importe les composants nécessaires depuis l'objet global React
        const { useState, useEffect, useRef } = React;

        // --- DÉBUT DU CODE DE L'APP ---
        
        const Icons = {
          Play: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
          Music: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>,
          Trophy: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55.47.98.97 1.21C11.47 18.44 12 19 12 19s.53-.56 1.03-.79c.5-.23.97-.66.97-1.21v-2.34"></path><path d="M12 15a6 6 0 0 0 6-6V3H6v6a6 6 0 0 0 6 6Z"></path></svg>,
          Clock: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
          ChevronLeft: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>,
          Users: () => <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2" fill="none" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>,
          Check: () => <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" strokeWidth="3" fill="none" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
        };

        const CATEGORIES = {
          Y2K: {
            id: "2000s",
            label: "Années 2000",
            color: "from-purple-600 to-blue-600",
            list: [
              { artist: "Britney Spears", title: "Toxic" },
              { artist: "Shakira", title: "Whenever Wherever" },
              { artist: "Eminem", title: "Without Me" },
              { artist: "Diam's", title: "La Boulette" },
              { artist: "Beyonce", title: "Crazy In Love" },
              { artist: "Evanescence", title: "Bring Me To Life" },
              { artist: "Black Eyed Peas", title: "I Gotta Feeling" },
              { artist: "K-Maro", title: "Femme Like U" },
              { artist: "Rihanna", title: "Umbrella" },
              { artist: "Lady Gaga", title: "Poker Face" }
            ]
          },
          MODERN: {
            id: "2025fr",
            label: "Top 2025 France",
            color: "from-red-600 to-orange-500",
            list: [
              { artist: "Gazo", title: "POP" },
              { artist: "SDM", title: "Cartier Santos" },
              { artist: "Tiakola", title: "Manon B" },
              { artist: "Pierre Garnier", title: "Chaque seconde" },
              { artist: "Santa", title: "Recommence-moi" },
              { artist: "Aya Nakamura", title: "Hypé" },
              { artist: "Slimane", title: "Mon Amour" },
              { artist: "Clara Luciani", title: "Tout pour moi" },
              { artist: "Carbonne", title: "Imagine" },
              { artist: "Damso", title: "Chrome" }
            ]
          }
        };

        const TIMER_DURATION = 15;

        function App() {
          const [gameState, setGameState] = useState('menu');
          const [category, setCategory] = useState(null);
          const [currentIdx, setCurrentIdx] = useState(0);
          const [team1, setTeam1] = useState({ name: "Équipe A", score: 0 });
          const [team2, setTeam2] = useState({ name: "Équipe B", score: 0 });
          const [timeLeft, setTimeLeft] = useState(TIMER_DURATION);
          const [guess, setGuess] = useState('');
          const [trackData, setTrackData] = useState(null);
          const [loading, setLoading] = useState(false);
          const [feedback, setFeedback] = useState({ show: false, artistFound: false, titleFound: false, pointsAwarded: { artist: 0, title: 0 } });
          const audioRef = useRef(null);
          const timerRef = useRef(null);

          const fetchTrack = async (index, cat) => {
            setLoading(true);
            setTrackData(null);
            const track = cat.list[index];
            try {
              const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(track.artist + " " + track.title)}&limit=1&entity=musicTrack`);
              const data = await response.json();
              if (data.results && data.results[0]) {
                const rawArt = data.results[0].artworkUrl100;
                const hdArt = rawArt.replace('100x100bb', '600x600bb');
                setTrackData({ ...data.results[0], hdArt });
              } else {
                setTrackData({ artistName: track.artist, trackName: track.title, previewUrl: "", hdArt: "" });
              }
            } catch (error) { console.error("Erreur API:", error); }
            setLoading(false);
          };

          const selectCategory = (catKey) => {
            const selectedCat = CATEGORIES[catKey];
            setCategory(selectedCat);
            setTeam1(prev => ({ ...prev, score: 0 }));
            setTeam2(prev => ({ ...prev, score: 0 }));
            setCurrentIdx(0);
            setGuess('');
            setGameState('playing');
            fetchTrack(0, selectedCat);
          };

          const checkAnswer = () => {
            if (loading || !trackData) return;
            const normalizedGuess = guess.toLowerCase().trim();
            const artist = trackData.artistName.toLowerCase();
            const title = trackData.trackName.toLowerCase();
            const artistFound = normalizedGuess.length > 2 && artist.includes(normalizedGuess);
            const titleFound = normalizedGuess.length > 2 && title.includes(normalizedGuess);
            setFeedback({ show: true, artistFound, titleFound, pointsAwarded: { artist: 0, title: 0 } });
            setGameState('feedback');
            clearInterval(timerRef.current);
            if (audioRef.current) audioRef.current.pause();
          };

          const togglePoint = (type, teamNum) => {
            setFeedback(prev => {
                const currentOwner = prev.pointsAwarded[type];
                const newOwner = currentOwner === teamNum ? 0 : teamNum;
                if (currentOwner === 1) setTeam1(t => ({ ...t, score: t.score - 1 }));
                if (currentOwner === 2) setTeam2(t => ({ ...t, score: t.score - 1 }));
                if (newOwner === 1) setTeam1(t => ({ ...t, score: t.score + 1 }));
                if (newOwner === 2) setTeam2(t => ({ ...t, score: t.score + 1 }));
                return { ...prev, pointsAwarded: { ...prev.pointsAwarded, [type]: newOwner } };
            });
          };

          const handleNext = () => {
            if (currentIdx + 1 < category.list.length) {
              const nextIdx = currentIdx + 1;
              setCurrentIdx(nextIdx);
              setGameState('playing');
              setGuess('');
              setTimeLeft(TIMER_DURATION);
              setFeedback({ show: false, artistFound: false, titleFound: false, pointsAwarded: { artist: 0, title: 0 } });
              fetchTrack(nextIdx, category);
            } else { setGameState('end'); }
          };

          useEffect(() => {
            if (gameState === 'playing' && !loading && trackData) {
              setTimeLeft(TIMER_DURATION);
              timerRef.current = setInterval(() => {
                setTimeLeft(prev => {
                  if (prev <= 1) {
                    clearInterval(timerRef.current);
                    setFeedback({ show: true, artistFound: false, titleFound: false, pointsAwarded: { artist: 0, title: 0 } });
                    setGameState('feedback');
                    return 0;
                  }
                  return prev - 1;
                });
              }, 1000);
            }
            return () => clearInterval(timerRef.current);
          }, [gameState, loading, trackData]);

          useEffect(() => {
            if (trackData?.previewUrl && audioRef.current && gameState === 'playing') {
              audioRef.current.load();
              audioRef.current.play().catch(() => {});
            }
          }, [trackData, gameState]);

          return (
            <div className="min-h-screen bg-neutral-950 text-white flex flex-col items-center justify-center p-4 font-sans">
              <div className="w-full max-w-md bg-neutral-900 rounded-[2.5rem] shadow-2xl overflow-hidden border border-neutral-800 relative min-h-[680px] flex flex-col">
                <div className={`p-8 text-center bg-gradient-to-r ${category ? category.color : 'from-neutral-800 to-neutral-900'} transition-all relative`}>
                  {gameState !== 'menu' && (
                    <button onClick={() => { setGameState('menu'); if(audioRef.current) audioRef.current.pause(); }} className="absolute top-8 left-6 p-2 bg-black/20 rounded-full">
                      <Icons.ChevronLeft />
                    </button>
                  )}
                  <h1 className="text-2xl font-black italic uppercase tracking-tighter">Blind Test Master</h1>
                  <p className="text-[10px] font-bold uppercase tracking-widest opacity-70 mt-1">{category ? category.label : "1 pt Artiste / 1 pt Titre"}</p>
                </div>
                <div className="p-8 flex-grow flex flex-col">
                  {gameState === 'menu' && (
                    <div className="space-y-6 animate-in fade-in duration-500 my-auto">
                      <div className="bg-neutral-800/50 p-6 rounded-3xl border border-white/5 space-y-4">
                        <div className="flex items-center gap-2 mb-2"><Icons.Users /><span className="text-xs font-black uppercase tracking-widest opacity-50">Équipes</span></div>
                        <div className="grid grid-cols-2 gap-3">
                            <input value={team1.name} onChange={(e) => setTeam1({...team1, name: e.target.value})} className="bg-black/40 border border-white/10 rounded-xl px-4 py-2 text-sm outline-none focus:border-purple-500" placeholder="Équipe 1"/>
                            <input value={team2.name} onChange={(e) => setTeam2({...team2, name: e.target.value})} className="bg-black/40 border border-white/10 rounded-xl px-4 py-2 text-sm outline-none focus:border-orange-500" placeholder="Équipe 2"/>
                        </div>
                      </div>
                      <div className="space-y-3">
                        {Object.entries(CATEGORIES).map(([key, cat]) => (
                            <button key={key} onClick={() => selectCategory(key)} className={`w-full bg-gradient-to-r ${cat.color} p-6 rounded-2xl flex items-center justify-between group hover:scale-[1.02] transition-all`}>
                                <div className="text-left"><span className="block text-xl font-black italic">{cat.label}</span><span className="text-xs font-bold opacity-70 uppercase">2 pts par chanson</span></div>
                                <div className="bg-white/20 p-2 rounded-full"><Icons.Play /></div>
                            </button>
                        ))}
                      </div>
                    </div>
                  )}
                  {gameState === 'playing' && (
                    <div className="flex-grow flex flex-col justify-between space-y-6">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-purple-600/20 border border-purple-500/30 p-3 rounded-2xl text-center"><p className="text-[9px] font-black uppercase tracking-widest text-purple-400 truncate">{team1.name}</p><p className="text-2xl font-black">{team1.score}</p></div>
                        <div className="bg-orange-600/20 border border-orange-500/30 p-3 rounded-2xl text-center"><p className="text-[9px] font-black uppercase tracking-widest text-orange-400 truncate">{team2.name}</p><p className="text-2xl font-black">{team2.score}</p></div>
                      </div>
                      <div className="text-center">
                        <div className="text-5xl font-black font-mono mb-2">{timeLeft}s</div>
                        <div className="h-1.5 w-full bg-neutral-800 rounded-full overflow-hidden"><div style={{ width: `${(timeLeft / TIMER_DURATION) * 100}%` }} className={`h-full transition-all duration-1000 linear ${timeLeft < 5 ? 'bg-red-500' : 'bg-white'}`} /></div>
                      </div>
                      {loading ? <div className="flex-grow flex flex-col items-center justify-center py-20"><div className="w-10 h-10 border-4 border-white/10 border-t-white rounded-full animate-spin"></div></div> : (
                        <div className="flex-grow flex flex-col justify-center space-y-8">
                          <audio ref={audioRef} src={trackData?.previewUrl} preload="auto" />
                          <div className="aspect-square bg-neutral-800 rounded-[2rem] flex items-center justify-center border border-white/5 relative overflow-hidden"><div className="animate-pulse opacity-50"><Icons.Music /></div></div>
                          <div className="space-y-4">
                            <input autoFocus value={guess} onChange={(e) => setGuess(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && checkAnswer()} placeholder="Artiste ou Titre ?" className="w-full bg-black border border-neutral-800 rounded-2xl p-5 text-center text-lg outline-none font-bold" />
                            <button onClick={checkAnswer} className="w-full bg-white text-black font-black py-5 rounded-2xl active:scale-95">VÉRIFIER</button>
                          </div>
                        </div>
                      )}
                    </div>
                  )}
                  {gameState === 'feedback' && (
                    <div className="flex-grow flex flex-col justify-center space-y-6">
                      <div className="text-center">
                        <div className="w-32 h-32 mx-auto mb-4"><img src={trackData?.hdArt} className="w-full h-full object-cover rounded-2xl shadow-2xl" /></div>
                        <p className="text-xl font-black text-white">{trackData?.artistName}</p><p className="text-neutral-500 font-medium text-sm italic">"{trackData?.trackName}"</p>
                      </div>
                      <div className="space-y-4">
                        <div className="bg-neutral-800/50 p-3 rounded-2xl border border-white/5">
                            <div className="text-[10px] font-bold text-neutral-400 mb-2 uppercase text-center">Artiste (1 pt)</div>
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => togglePoint('artist', 1)} className={`py-3 rounded-xl text-xs font-black transition-all flex items-center justify-center gap-2 ${feedback.pointsAwarded.artist === 1 ? 'bg-purple-600' : 'bg-black/40 text-neutral-500'}`}>{feedback.pointsAwarded.artist === 1 && <Icons.Check />} {team1.name}</button>
                                <button onClick={() => togglePoint('artist', 2)} className={`py-3 rounded-xl text-xs font-black transition-all flex items-center justify-center gap-2 ${feedback.pointsAwarded.artist === 2 ? 'bg-orange-600' : 'bg-black/40 text-neutral-500'}`}>{feedback.pointsAwarded.artist === 2 && <Icons.Check />} {team2.name}</button>
                            </div>
                        </div>
                        <div className="bg-neutral-800/50 p-3 rounded-2xl border border-white/5">
                            <div className="text-[10px] font-bold text-neutral-400 mb-2 uppercase text-center">Titre (1 pt)</div>
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => togglePoint('title', 1)} className={`py-3 rounded-xl text-xs font-black transition-all flex items-center justify-center gap-2 ${feedback.pointsAwarded.title === 1 ? 'bg-purple-600' : 'bg-black/40 text-neutral-500'}`}>{feedback.pointsAwarded.title === 1 && <Icons.Check />} {team1.name}</button>
                                <button onClick={() => togglePoint('title', 2)} className={`py-3 rounded-xl text-xs font-black transition-all flex items-center justify-center gap-2 ${feedback.pointsAwarded.title === 2 ? 'bg-orange-600' : 'bg-black/40 text-neutral-500'}`}>{feedback.pointsAwarded.title === 2 && <Icons.Check />} {team2.name}</button>
                            </div>
                        </div>
                        <button onClick={handleNext} className="w-full bg-white text-black font-black py-4 rounded-2xl shadow-xl">CONTINUER</button>
                      </div>
                    </div>
                  )}
                  {gameState === 'end' && (
                    <div className="flex-grow flex flex-col items-center justify-center text-center space-y-8 py-6">
                      <div className="text-yellow-500 scale-[2.5] mb-6"><Icons.Trophy /></div>
                      <div className="space-y-4 w-full">
                        <h2 className="text-3xl font-black italic uppercase italic">Résultats</h2>
                        <div className={`p-6 rounded-3xl flex justify-between items-center ${team1.score >= team2.score ? 'bg-purple-600' : 'bg-neutral-800'}`}><span className="font-black italic">{team1.name}</span><span className="text-4xl font-black">{team1.score}</span></div>
                        <div className={`p-6 rounded-3xl flex justify-between items-center ${team2.score >= team1.score ? 'bg-orange-600' : 'bg-neutral-800'}`}><span className="font-black italic">{team2.name}</span><span className="text-4xl font-black">{team2.score}</span></div>
                      </div>
                      <button onClick={() => setGameState('menu')} className="w-full bg-white text-black font-black py-5 rounded-2xl shadow-xl">REJOUER</button>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
